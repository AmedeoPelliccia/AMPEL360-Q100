{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ampel360.eu/schemas/nku_production_schema.json",
  "title": "NKU Production Event Schema",
  "description": "Schema for Net Knowledge Unit (NKU) completion and evidence recording",
  "type": "object",
  "required": ["nku_id", "knot_id", "timestamp", "lifecycle_category", "status", "uncertainty_reduction"],
  "properties": {
    "nku_id": {
      "type": "string",
      "pattern": "^KNU-[0-9]{2}-[0-9]{2}-[0-9]{3}-LC[0-9]{2}-.*$",
      "description": "Knowledge Unit identifier (e.g., KNU-25-10-001-LC02-SEAT-LAYOUT-REQ)"
    },
    "knot_id": {
      "type": "string",
      "pattern": "^KNOT-[0-9]{2}-[0-9]{2}-[0-9]{3}$",
      "description": "Parent KNOT identifier"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "NKU completion timestamp (ISO 8601 UTC)"
    },
    "lifecycle_category": {
      "type": "string",
      "pattern": "^LC[0-9]{2}$",
      "description": "Lifecycle category (e.g., LC02, LC04)"
    },
    "title": {
      "type": "string",
      "description": "Human-readable NKU title"
    },
    "description": {
      "type": "string",
      "description": "Detailed description of NKU and its contribution"
    },
    "status": {
      "type": "string",
      "enum": ["planned", "in_progress", "completed", "verified", "published"],
      "description": "NKU status"
    },
    "uncertainty_reduction": {
      "type": "object",
      "required": ["baseline", "target", "achieved"],
      "properties": {
        "baseline": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Baseline residual uncertainty (%)"
        },
        "target": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Target residual uncertainty (%)"
        },
        "achieved": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Achieved residual uncertainty (%)"
        },
        "reduction_percentage": {
          "type": "number",
          "description": "Percentage reduction from baseline"
        }
      }
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "artifact_type": {
            "type": "string",
            "enum": ["requirement", "design", "analysis", "test", "publication", "model", "data"]
          },
          "artifact_path": {
            "type": "string",
            "description": "Path to artifact in SSOT/"
          },
          "execution_timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "hash": {
            "type": "string",
            "pattern": "^sha256:[0-9a-f]{64}$"
          }
        }
      }
    },
    "contributors": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "contributor_id": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "pattern": "^STK_[A-Z]+$"
          },
          "contribution_type": {
            "type": "string",
            "enum": ["primary", "supporting", "review"]
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "properties": {
        "genesis_path": {
          "type": "string",
          "description": "Path to GENESIS/ provenance (O-KNOT → Y-KNOT → KNOT)"
        },
        "derivation_yaml": {
          "type": "string",
          "description": "Path to _derivation.yaml"
        }
      }
    },
    "verification": {
      "type": "object",
      "properties": {
        "verified_by": {
          "type": "string"
        },
        "verification_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "verification_method": {
          "type": "string"
        },
        "verification_status": {
          "type": "string",
          "enum": ["passed", "failed", "pending"]
        }
      }
    }
  }
}
